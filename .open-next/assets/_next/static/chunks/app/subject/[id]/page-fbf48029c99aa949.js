(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[609],{3919:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>w,runtime:()=>h});var s=a(5155),n=a(9137),r=a.n(n),d=a(5695),c=a(2115),i=a(79),l=a(3231),b=a(2944),o=a(6773),u=a(4147),x=a(6399),f=a(6694),m=a(7223),g=a(8882),y=a(8794),j=a(9746),p=a(3568);let h="edge";function w(){let{id:e}=(0,d.useParams)(),t=(0,d.useRouter)(),[a,n]=(0,c.useState)(null),[h,w]=(0,c.useState)(new Date),[N,k]=(0,c.useState)(null),[v,M]=(0,c.useState)(null);if((0,c.useEffect)(()=>{let t=async()=>{let t=(await (0,j.u7)()).find(t=>t.id===e);t&&"createdAt"in t?n(t):n(null)};e&&t()},[e]),!a)return(0,s.jsx)("div",{className:"p-8 text-center",children:"Loading Subject..."});let S=(0,i.k)({start:(0,l.w)(h),end:(0,b.p)(h)}),P=(0,l.w)(h).getDay(),I=async e=>{if((0,o.G)(e)||(0,u.c)(e)||e<new Date(a.createdAt)||!(0,x.c)(e))return;let t=(0,f.GP)(e,"yyyy-MM-dd");k(t),M("loading"),M("present"===await (0,j.yH)(a.id,t)?"present":"absent")},A=async()=>{N&&(await (0,j.rq)(a.id,N),p.Ay.success("Marked present!"),M("present"))},D=async()=>{N&&(await (0,j.UX)(a.id,N),p.Ay.success("Changed to absent/undone!"),M("absent"))},C=e=>{let{day:t}=e,[n,r]=(0,c.useState)("absent"),[d,i]=(0,c.useState)(!0),l=(0,f.GP)(t,"yyyy-MM-dd");(0,c.useEffect)(()=>{(async()=>{if(i(!0),(0,u.c)(t)){r("weekend"),i(!1);return}if((0,o.G)(t)){r("future"),i(!1);return}(0,x.c)(t)&&r("today"),r("present"===await (0,j.yH)(a.id,l)?"present":"absent"),i(!1)})()},[h,a.id]);let b=N===l,m="";return m="present"===n?b?"bg-green-500 text-white":"bg-green-100 border-green-400":"absent"===n?b?"bg-red-500 text-white":"bg-red-100 border-red-300":"future"===n?"bg-gray-100 text-gray-400 cursor-not-allowed":"weekend"===n?"bg-gray-200 text-gray-400 cursor-not-allowed":"today"===n?b?"bg-blue-500 text-white":"border-blue-500 text-blue-600":"bg-white border-gray-300",(0,s.jsx)("button",{onClick:()=>I(t),disabled:(0,o.G)(t)||(0,u.c)(t),"aria-pressed":b,title:(0,f.GP)(t,"eeee, MMMM do yyyy"),className:"aspect-square flex items-center justify-center rounded-full border  transition font-semibold focus:outline-none focus:ring-2 focus:ring-blue-400 ".concat(m),style:{minWidth:36,minHeight:36,transition:"all 0.15s"},children:d?"...":t.getDate()})};return(0,s.jsxs)("main",{className:"p-4 max-w-md mx-auto mb-28",children:[(0,s.jsx)("span",{className:"mb-3 block text-sm text-blue-500 hover:underline cursor-pointer",onClick:()=>t.back(),children:"← Back"}),(0,s.jsx)("h2",{className:"text-2xl font-bold text-center mb-3",children:a.name}),(0,s.jsxs)("section",{className:"jsx-942410518fb9b4d8 rounded-xl bg-white shadow-lg p-5",children:[(0,s.jsxs)("header",{className:"jsx-942410518fb9b4d8 flex justify-between items-center mb-4",children:[(0,s.jsx)("button",{onClick:()=>{w((0,m.a)(h,1)),k(null),M(null)},className:"jsx-942410518fb9b4d8 text-blue-600 hover:underline px-2 py-1",children:"Prev"}),(0,s.jsx)("h3",{className:"jsx-942410518fb9b4d8 text-xl font-semibold text-gray-800",children:(0,f.GP)(h,"MMMM yyyy")}),(0,s.jsx)("button",{onClick:()=>{w((0,g.P)(h,1)),k(null),M(null)},className:"jsx-942410518fb9b4d8 text-blue-600 hover:underline px-2 py-1",children:"Next"})]}),(0,s.jsx)("div",{className:"jsx-942410518fb9b4d8 grid grid-cols-7 gap-2 text-xs font-bold mb-1 select-none",children:["S","M","T","W","T","F","S"].map(e=>(0,s.jsx)("div",{className:"jsx-942410518fb9b4d8 uppercase text-center",children:e},e))}),(0,s.jsxs)("div",{className:"jsx-942410518fb9b4d8 grid grid-cols-7 gap-2",children:[Array.from({length:P}).map((e,t)=>(0,s.jsx)("div",{className:"jsx-942410518fb9b4d8"},"empty-".concat(t))),S.map(e=>(0,s.jsx)(C,{day:e},(0,f.GP)(e,"yyyy-MM-dd")))]}),N&&(0,s.jsxs)("div",{className:"jsx-942410518fb9b4d8 mt-6 rounded-lg bg-gray-50 p-4 border flex flex-col items-center animate-fadeIn",children:[(0,s.jsx)("div",{className:"jsx-942410518fb9b4d8 font-medium",children:(0,s.jsx)("span",{className:"jsx-942410518fb9b4d8 text-blue-700",children:(0,f.GP)((0,y.H)(N),"PPP")})}),"loading"===v?(0,s.jsx)("div",{className:"jsx-942410518fb9b4d8 mt-2 text-sm text-gray-600",children:"Checking attendance..."}):(0,s.jsx)("div",{className:"jsx-942410518fb9b4d8 mt-3 flex gap-3 items-center",children:(0,s.jsx)("button",{onClick:async()=>{"present"===v?await D():await A()},"aria-label":"present"===v?"Mark as absent":"Mark as present",className:"jsx-942410518fb9b4d8 "+"px-4 py-2 rounded font-semibold transition ".concat("present"===v?"bg-green-500 text-white":"bg-gray-700 text-white hover:bg-green-500"),children:"present"===v?"Undo / Mark Absent":"Mark Present"})})]}),(0,s.jsxs)("div",{className:"jsx-942410518fb9b4d8 flex flex-wrap gap-3 mt-8 justify-center text-xs font-medium text-gray-700 select-none",children:[(0,s.jsxs)("div",{className:"jsx-942410518fb9b4d8 flex items-center gap-1",children:[(0,s.jsx)("div",{className:"jsx-942410518fb9b4d8 w-4 h-4 bg-green-100 rounded-full border border-green-400"})," ","Present"]}),(0,s.jsxs)("div",{className:"jsx-942410518fb9b4d8 flex items-center gap-1",children:[(0,s.jsx)("div",{className:"jsx-942410518fb9b4d8 w-4 h-4 bg-red-100 rounded-full border border-red-400"})," ","Absent"]}),(0,s.jsxs)("div",{className:"jsx-942410518fb9b4d8 flex items-center gap-1",children:[(0,s.jsx)("div",{className:"jsx-942410518fb9b4d8 w-4 h-4 bg-blue-100 rounded-full border border-blue-400"})," ","Today"]}),(0,s.jsxs)("div",{className:"jsx-942410518fb9b4d8 flex items-center gap-1",children:[(0,s.jsx)("div",{className:"jsx-942410518fb9b4d8 w-4 h-4 bg-gray-200 rounded-full border border-gray-300"})," ","Weekend"]}),(0,s.jsxs)("div",{className:"jsx-942410518fb9b4d8 flex items-center gap-1",children:[(0,s.jsx)("div",{className:"jsx-942410518fb9b4d8 w-4 h-4 bg-gray-100 rounded-full border border-gray-400"})," ","Future"]})]}),(0,s.jsx)(r(),{id:"942410518fb9b4d8",children:"@-webkit-keyframes fadeIn{from{opacity:0}to{opacity:1}}@-moz-keyframes fadeIn{from{opacity:0}to{opacity:1}}@-o-keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}.animate-fadeIn.jsx-942410518fb9b4d8{-webkit-animation:fadeIn.2s ease-in;-moz-animation:fadeIn.2s ease-in;-o-animation:fadeIn.2s ease-in;animation:fadeIn.2s ease-in}"})]})]})}},4379:(e,t,a)=>{Promise.resolve().then(a.bind(a,3919))},9746:(e,t,a)=>{"use strict";a.d(t,{UX:()=>f,gg:()=>u,oX:()=>b,rq:()=>x,u7:()=>o,vY:()=>g,yH:()=>m});var s=a(198),n=a(714),r=a(79),d=a(4147);let c=null;function i(){let e=new Date;return"".concat(e.getFullYear(),"-").concat((e.getMonth()+1).toString().padStart(2,"0"),"-").concat(e.getDate().toString().padStart(2,"0"))}function l(){return c||(c=(0,s.P2)("attendance-db",1,{upgrade(e){e.objectStoreNames.contains("subjects")||e.createObjectStore("subjects",{keyPath:"id"}),e.objectStoreNames.contains("attendance")||e.createObjectStore("attendance",{keyPath:"id"})}})),c}let b=async e=>{let t=new Date;6===t.getDay()?t=(0,n.f)(t,2):0===t.getDay()&&(t=(0,n.f)(t,1));let a=await l();await a.add("subjects",{id:crypto.randomUUID(),name:e,createdAt:t.toISOString().slice(0,10)})},o=async()=>(await l()).getAll("subjects"),u=async e=>{let t=await l();for(let a of(await t.delete("subjects",e),(await t.getAll("attendance")).filter(t=>t.subjectId===e)))await t.delete("attendance",a.id)},x=async(e,t)=>{let a=i(),s=t||a,n="".concat(e,"_").concat(s),r=await l();await r.put("attendance",{id:n,subjectId:e,date:s,status:"present"})},f=async(e,t)=>{let a=i(),s="".concat(e,"_").concat(t||a),n=await l();await n.delete("attendance",s)},m=async(e,t)=>{let a=await l(),s="".concat(e,"_").concat(t),n=await a.get("attendance",s);return n&&"present"===n.status?"present":"absent"},g=async e=>{let t=await l(),a=await t.get("subjects",e);if(!a)return{present:0,total:0,percent:0};let s=new Set((await t.getAll("attendance")).filter(t=>t.subjectId===e).filter(e=>"present"===e.status).map(e=>e.date)).size,n=new Date(a.createdAt),c=new Date(i()),b=(0,r.k)({start:n,end:c}).filter(e=>!(0,d.c)(e)).length,o=0===b?0:Math.round(s/b*100);return{present:s,total:b,percent:o}}}},e=>{var t=t=>e(e.s=t);e.O(0,[3568,9009,9417,8441,1317,7358],()=>t(4379)),_N_E=e.O()}]);