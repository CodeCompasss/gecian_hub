(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[344],{4410:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>d});var n=a(5155),s=a(2115),c=a(5695),r=a(3568),l=a(9746);function i(e){let{percent:t}=e,a=2*Math.PI*21,s=Math.min(t,100);return(0,n.jsxs)("svg",{width:55,height:55,children:[(0,n.jsx)("circle",{stroke:"#e5e7eb",strokeWidth:7,fill:"none",cx:28,cy:28,r:21}),(0,n.jsx)("circle",{stroke:"#2563eb",strokeWidth:7,fill:"none",cx:28,cy:28,r:21,strokeDasharray:a,strokeDashoffset:a-s/100*a,strokeLinecap:"round",style:{transition:"stroke-dashoffset 0.5s ease"}}),(0,n.jsxs)("text",{x:"55%",y:"53%",textAnchor:"middle",alignmentBaseline:"middle",fontSize:"0.90em",fill:"#2563eb",fontWeight:700,children:[t,"%"]})]})}function o(e){let{subject:t,onRequestDelete:a}=e,[o,d]=(0,s.useState)("loading"),[u,b]=(0,s.useState)({present:0,total:0,percent:0}),x=new Date().toISOString().slice(0,10);(0,s.useEffect)(()=>{h(),g()},[]);let h=async()=>{d("present"===await (0,l.yH)(t.id,x)?"present":"absent")},g=async()=>{b(await (0,l.vY)(t.id))},m=async e=>{e.stopPropagation(),await (0,l.rq)(t.id,x),r.Ay.success("Marked present for ".concat(t.name)),h(),g()},p=async e=>{e.stopPropagation(),await (0,l.UX)(t.id,x),r.Ay.success("Marked absent/undone for ".concat(t.name)),h(),g()},y=(0,c.useRouter)();return(0,n.jsxs)("li",{className:"border border-gray-300 p-5 rounded-xl shadow-sm bg-white flex justify-between items-center gap-4 hover:shadow-md transition-shadow cursor-pointer ",onClick:()=>{y.push("/subject/".concat(t.id))},tabIndex:0,title:'Go to calendar for "'.concat(t.name,'"'),children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,n.jsx)(i,{percent:u.percent||0}),(0,n.jsx)("span",{className:"text-2xl font-semibold text-gray-800",children:t.name})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{onClick:m,className:"px-3 py-1 rounded transition ".concat("present"===o?"bg-green-500 text-white cursor-not-allowed opacity-70":"bg-gray-800 text-white hover:bg-gray-700"),disabled:"present"===o,children:"Present"}),(0,n.jsx)("button",{onClick:p,className:"px-3 py-1 rounded transition ".concat("absent"===o?"bg-red-500 text-white cursor-not-allowed opacity-70":"bg-gray-800 text-white hover:bg-gray-700"),disabled:"absent"===o,children:"Absent"}),(0,n.jsx)("button",{onClick:e=>{e.stopPropagation(),a(t)},className:"bg-red-500 text-white px-3 py-1 rounded hover:bg-red-700",children:"\uD83D\uDDD1"})]})]})}function d(){let[e,t]=(0,s.useState)([]),[a,c]=(0,s.useState)(""),[i,d]=(0,s.useState)(!1),[u,b]=(0,s.useState)(null),x=async()=>{t(await (0,l.u7)())};(0,s.useEffect)(()=>{x()},[]);let h=async()=>{""!==a.trim()&&(await (0,l.oX)(a.trim()),c(""),d(!1),r.Ay.success("Subject added!"),x())},g=async()=>{u&&(await (0,l.gg)(u.id),r.Ay.success("Deleted ".concat(u.name)),b(null),x())};return(0,n.jsxs)("main",{className:"p-6 max-w-2xl mx-auto min-h-screen pb-24",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold mb-8 text-center text-blue-800",children:"Attendance Tracker"}),(0,n.jsxs)("ul",{className:"space-y-5",children:[0===e.length&&(0,n.jsx)("li",{className:"text-center text-gray-500",children:"No subjects yet."}),e.map(e=>(0,n.jsx)(o,{subject:e,onRequestDelete:b,fetchSubjects:x},e.id))]}),(0,n.jsx)("button",{className:"fixed bottom-24 right-6 bg-blue-600 text-white text-3xl w-14 h-14 rounded-full shadow-lg hover:bg-blue-700 transition",onClick:()=>d(!0),"aria-label":"Add Subject",children:"+"}),i&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex justify-center items-center z-50",children:(0,n.jsxs)("div",{className:"bg-white p-6 rounded-lg w-[90%] max-w-md shadow-xl",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-4 text-center",children:"Add New Subject"}),(0,n.jsx)("input",{type:"text",className:"w-full border border-gray-300 rounded px-4 py-2 mb-4 focus:outline-none focus:ring-2 focus:ring-blue-400",placeholder:"Enter subject name",value:a,onChange:e=>c(e.target.value),autoFocus:!0,onKeyDown:e=>"Enter"===e.key&&h()}),(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsx)("button",{onClick:()=>d(!1),className:"px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400",children:"Cancel"}),(0,n.jsx)("button",{onClick:h,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Add"})]})]})}),u&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex justify-center items-center z-50",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-sm w-[90%] shadow-lg",children:[(0,n.jsx)("h3",{className:"text-xl font-semibold mb-4 text-center",children:"Confirm Delete"}),(0,n.jsxs)("p",{className:"mb-6 text-center",children:["Are you sure you want to delete ",(0,n.jsx)("strong",{children:u.name})," and all its attendance?"]}),(0,n.jsxs)("div",{className:"flex justify-center gap-4",children:[(0,n.jsx)("button",{className:"px-4 py-2 bg-gray-300 rounded hover:bg-gray-400",onClick:()=>b(null),children:"Cancel"}),(0,n.jsx)("button",{className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",onClick:g,children:"Delete"})]})]})})]})}},6688:(e,t,a)=>{Promise.resolve().then(a.bind(a,4410))},9746:(e,t,a)=>{"use strict";a.d(t,{UX:()=>h,gg:()=>b,oX:()=>d,rq:()=>x,u7:()=>u,vY:()=>m,yH:()=>g});var n=a(198),s=a(714),c=a(79),r=a(4147);let l=null;function i(){let e=new Date;return"".concat(e.getFullYear(),"-").concat((e.getMonth()+1).toString().padStart(2,"0"),"-").concat(e.getDate().toString().padStart(2,"0"))}function o(){return l||(l=(0,n.P2)("attendance-db",1,{upgrade(e){e.objectStoreNames.contains("subjects")||e.createObjectStore("subjects",{keyPath:"id"}),e.objectStoreNames.contains("attendance")||e.createObjectStore("attendance",{keyPath:"id"})}})),l}let d=async e=>{let t=new Date;6===t.getDay()?t=(0,s.f)(t,2):0===t.getDay()&&(t=(0,s.f)(t,1));let a=await o();await a.add("subjects",{id:crypto.randomUUID(),name:e,createdAt:t.toISOString().slice(0,10)})},u=async()=>(await o()).getAll("subjects"),b=async e=>{let t=await o();for(let a of(await t.delete("subjects",e),(await t.getAll("attendance")).filter(t=>t.subjectId===e)))await t.delete("attendance",a.id)},x=async(e,t)=>{let a=i(),n=t||a,s="".concat(e,"_").concat(n),c=await o();await c.put("attendance",{id:s,subjectId:e,date:n,status:"present"})},h=async(e,t)=>{let a=i(),n="".concat(e,"_").concat(t||a),s=await o();await s.delete("attendance",n)},g=async(e,t)=>{let a=await o(),n="".concat(e,"_").concat(t),s=await a.get("attendance",n);return s&&"present"===s.status?"present":"absent"},m=async e=>{let t=await o(),a=await t.get("subjects",e);if(!a)return{present:0,total:0,percent:0};let n=new Set((await t.getAll("attendance")).filter(t=>t.subjectId===e).filter(e=>"present"===e.status).map(e=>e.date)).size,s=new Date(a.createdAt),l=new Date(i()),d=(0,c.k)({start:s,end:l}).filter(e=>!(0,r.c)(e)).length,u=0===d?0:Math.round(n/d*100);return{present:n,total:d,percent:u}}}},e=>{var t=t=>e(e.s=t);e.O(0,[3568,9009,8441,1317,7358],()=>t(6688)),_N_E=e.O()}]);